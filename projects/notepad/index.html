<!DOCTYPE html>
<html lang="pl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notatnik — Kacper</title>
    <style>
        :root[data-theme="dark"] {
            --bg: #0f0f1a;
            --bg-card: #1a1a2e;
            --bg-input: #16213e;
            --bg-sidebar: #151528;
            --border: #2a2a4a;
            --text: #e0e0e0;
            --text-muted: #8888aa;
            --accent: #6c5ce7;
            --accent-hover: #a29bfe;
            --toggle-bg: #2a2a4a;
            --shadow: rgba(0,0,0,0.3);
            --preview-bg: #16213e;
            --code-bg: #0d0d1a;
            --danger: #e74c3c;
            --danger-hover: #c0392b;
        }
        :root[data-theme="light"] {
            --bg: #f0f2f5;
            --bg-card: #ffffff;
            --bg-input: #f8f9fa;
            --bg-sidebar: #f0f0f5;
            --border: #ddd;
            --text: #1a1a2e;
            --text-muted: #666;
            --accent: #6c5ce7;
            --accent-hover: #5a4bd1;
            --toggle-bg: #ddd;
            --shadow: rgba(0,0,0,0.1);
            --preview-bg: #fafafa;
            --code-bg: #f0f0f0;
            --danger: #e74c3c;
            --danger-hover: #c0392b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background 0.3s, color 0.3s;
        }

        /* Top bar */
        .top-bar {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 0.6rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            flex-shrink: 0;
            transition: background 0.3s, border-color 0.3s;
        }

        .top-bar h1 {
            font-size: 1.1rem;
            color: var(--accent);
            white-space: nowrap;
        }

        .top-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn {
            padding: 0.45rem 0.9rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-input);
            color: var(--text);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn:hover { border-color: var(--accent); color: var(--accent); }

        .btn-accent {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .btn-accent:hover { background: var(--accent-hover); color: white; }

        .btn-danger { color: var(--danger); }
        .btn-danger:hover { background: var(--danger); color: white; border-color: var(--danger); }

        .theme-toggle {
            background: var(--toggle-bg);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s, transform 0.2s;
        }

        .theme-toggle:hover { transform: scale(1.1); }
        [data-theme="dark"] .icon-light { display: none; }
        [data-theme="dark"] .icon-dark { display: inline; }
        [data-theme="light"] .icon-light { display: inline; }
        [data-theme="light"] .icon-dark { display: none; }

        /* Main layout */
        .main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            transition: background 0.3s, border-color 0.3s, transform 0.3s;
        }

        .sidebar-header {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header span {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .new-btn {
            background: var(--accent);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .new-btn:hover { background: var(--accent-hover); }

        .notes-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .note-item {
            padding: 0.6rem 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 2px;
            transition: background 0.2s;
        }

        .note-item:hover { background: var(--bg-input); }

        .note-item.active {
            background: var(--accent);
            color: white;
        }

        .note-item-title {
            font-size: 0.85rem;
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .note-item-date {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .note-item.active .note-item-date { color: rgba(255,255,255,0.7); }

        .empty-list {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Editor area */
        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Tab bar */
        .tab-bar {
            display: flex;
            border-bottom: 1px solid var(--border);
            background: var(--bg-card);
            flex-shrink: 0;
            transition: background 0.3s;
        }

        .tab {
            padding: 0.6rem 1.2rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
        }

        .tab:hover { color: var(--text); }
        .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

        /* Title input */
        .title-input {
            border: none;
            border-bottom: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text);
            padding: 0.75rem 1rem;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: inherit;
            outline: none;
            transition: background 0.3s, border-color 0.3s;
        }

        .title-input::placeholder { color: var(--text-muted); }
        .title-input:focus { border-bottom-color: var(--accent); }

        /* Editor / Preview panels */
        .panels {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .editor-panel, .preview-panel {
            flex: 1;
            overflow-y: auto;
            transition: opacity 0.2s;
        }

        .editor-panel textarea {
            width: 100%;
            height: 100%;
            border: none;
            background: var(--bg-card);
            color: var(--text);
            padding: 1rem;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            resize: none;
            outline: none;
            transition: background 0.3s;
        }

        .editor-panel textarea::placeholder { color: var(--text-muted); }

        .preview-panel {
            background: var(--preview-bg);
            padding: 1rem;
            display: none;
            transition: background 0.3s;
        }

        /* View modes */
        .panels[data-view="edit"] .editor-panel { display: block; }
        .panels[data-view="edit"] .preview-panel { display: none; }
        .panels[data-view="preview"] .editor-panel { display: none; }
        .panels[data-view="preview"] .preview-panel { display: block; }
        .panels[data-view="split"] .editor-panel { display: block; flex: 1; border-right: 1px solid var(--border); }
        .panels[data-view="split"] .preview-panel { display: block; flex: 1; }

        /* Preview markdown styles */
        .preview-panel h1 { font-size: 1.8rem; margin: 0 0 0.75rem; color: var(--accent); }
        .preview-panel h2 { font-size: 1.4rem; margin: 1.25rem 0 0.5rem; color: var(--accent-hover); border-bottom: 1px solid var(--border); padding-bottom: 0.3rem; }
        .preview-panel h3 { font-size: 1.15rem; margin: 1rem 0 0.4rem; }
        .preview-panel p { margin: 0.5rem 0; line-height: 1.7; }
        .preview-panel ul, .preview-panel ol { margin: 0.5rem 0 0.5rem 1.5rem; }
        .preview-panel li { margin: 0.25rem 0; line-height: 1.6; }
        .preview-panel code {
            background: var(--code-bg);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.85em;
        }
        .preview-panel pre {
            background: var(--code-bg);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 0.75rem 0;
        }
        .preview-panel pre code { background: none; padding: 0; }
        .preview-panel blockquote {
            border-left: 3px solid var(--accent);
            padding: 0.5rem 1rem;
            margin: 0.75rem 0;
            color: var(--text-muted);
            background: var(--bg-input);
            border-radius: 0 8px 8px 0;
        }
        .preview-panel a { color: var(--accent); }
        .preview-panel hr { border: none; border-top: 1px solid var(--border); margin: 1rem 0; }
        .preview-panel strong { font-weight: 700; }
        .preview-panel em { font-style: italic; }

        /* Welcome screen */
        .welcome-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            gap: 0.75rem;
        }

        .welcome-screen .welcome-icon { font-size: 3rem; }
        .welcome-screen p { font-size: 0.95rem; }

        /* Saved indicator */
        .save-indicator {
            font-size: 0.75rem;
            color: var(--text-muted);
            padding: 0.3rem 0.6rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .save-indicator.visible { opacity: 1; }

        /* Sidebar toggle for mobile */
        .sidebar-toggle {
            display: none;
            background: var(--toggle-bg);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            align-items: center;
            justify-content: center;
            color: var(--text);
            transition: background 0.2s;
        }

        /* Back link */
        .back-link {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.8rem;
            transition: color 0.3s;
        }

        .back-link:hover { color: var(--accent); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        /* Word count */
        .status-bar {
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            padding: 0.3rem 1rem;
            font-size: 0.7rem;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            flex-shrink: 0;
            transition: background 0.3s, border-color 0.3s;
        }

        /* Responsive */
        @media (max-width: 700px) {
            .sidebar {
                position: fixed;
                left: 0; top: 0; bottom: 0;
                z-index: 100;
                transform: translateX(-100%);
            }

            .sidebar.open { transform: translateX(0); }

            .sidebar-toggle { display: flex; }

            .sidebar-backdrop {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.5);
                z-index: 99;
            }

            .sidebar-backdrop.visible { display: block; }

            .panels[data-view="split"] .editor-panel { flex: 1; border-right: none; }
            .panels[data-view="split"] .preview-panel { display: none; }
            .panels[data-view="split"] .editor-panel { display: block; }

            .top-bar h1 { font-size: 0.95rem; }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div style="display:flex;align-items:center;gap:0.5rem;">
            <button class="sidebar-toggle" id="sidebarToggle">&#9776;</button>
            <h1>Notatnik</h1>
        </div>
        <div class="top-actions">
            <span class="save-indicator" id="saveIndicator">Zapisano</span>
            <a href="../../index.html" class="back-link">&larr; Portfolio</a>
            <button class="theme-toggle" id="themeToggle" aria-label="Zmien motyw">
                <span class="icon-dark">&#9790;</span>
                <span class="icon-light">&#9728;</span>
            </button>
        </div>
    </div>

    <div class="main">
        <div class="sidebar-backdrop" id="sidebarBackdrop"></div>
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <span>Notatki</span>
                <button class="new-btn" id="newNoteBtn" title="Nowa notatka">+</button>
            </div>
            <div class="notes-list" id="notesList"></div>
        </aside>

        <div class="editor-area" id="editorArea">
            <!-- Welcome (no note selected) -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-icon">&#128221;</div>
                <p>Wybierz notatke lub stworz nowa</p>
            </div>

            <!-- Editor (note selected) -->
            <div id="editorView" style="display:none;flex:1;flex-direction:column;overflow:hidden;">
                <input type="text" class="title-input" id="titleInput" placeholder="Tytul notatki...">
                <div class="tab-bar">
                    <button class="tab active" data-view="edit">Edytor</button>
                    <button class="tab" data-view="preview">Podglad</button>
                    <button class="tab" data-view="split">Podziel</button>
                </div>
                <div class="panels" id="panels" data-view="edit">
                    <div class="editor-panel">
                        <textarea id="editor" placeholder="Pisz w Markdown...&#10;&#10;# Naglowek&#10;**pogrubienie**, *kursywa*&#10;- lista&#10;> cytat&#10;`kod`"></textarea>
                    </div>
                    <div class="preview-panel" id="preview"></div>
                </div>
                <div class="status-bar">
                    <span id="wordCount">0 slow</span>
                    <span id="charCount">0 znakow</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ---- Storage ----
        function loadNotes() {
            try { return JSON.parse(localStorage.getItem('notepad-notes')) || []; }
            catch { return []; }
        }

        function saveNotes(notes) {
            localStorage.setItem('notepad-notes', JSON.stringify(notes));
        }

        // ---- State ----
        let notes = loadNotes();
        let activeId = null;
        let saveTimeout = null;

        // ---- Elements ----
        const notesList = document.getElementById('notesList');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const editorView = document.getElementById('editorView');
        const titleInput = document.getElementById('titleInput');
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const panels = document.getElementById('panels');
        const saveIndicator = document.getElementById('saveIndicator');
        const wordCountEl = document.getElementById('wordCount');
        const charCountEl = document.getElementById('charCount');
        const sidebar = document.getElementById('sidebar');
        const sidebarBackdrop = document.getElementById('sidebarBackdrop');

        // ---- Theme ----
        const themeToggle = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('notepad-theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);

        themeToggle.addEventListener('click', () => {
            const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('notepad-theme', next);
        });

        // ---- Sidebar toggle (mobile) ----
        document.getElementById('sidebarToggle').addEventListener('click', () => {
            sidebar.classList.toggle('open');
            sidebarBackdrop.classList.toggle('visible');
        });

        sidebarBackdrop.addEventListener('click', () => {
            sidebar.classList.remove('open');
            sidebarBackdrop.classList.remove('visible');
        });

        // ---- Render notes list ----
        function renderList() {
            if (notes.length === 0) {
                notesList.innerHTML = '<div class="empty-list">Brak notatek.<br>Kliknij + aby dodac.</div>';
                return;
            }

            notesList.innerHTML = notes
                .sort((a, b) => b.updated - a.updated)
                .map(n => `
                    <div class="note-item ${n.id === activeId ? 'active' : ''}" data-id="${n.id}">
                        <div class="note-item-title">${escapeHtml(n.title || 'Bez tytulu')}</div>
                        <div class="note-item-date">${formatDate(n.updated)}</div>
                    </div>
                `).join('');

            notesList.querySelectorAll('.note-item').forEach(item => {
                item.addEventListener('click', () => {
                    openNote(item.dataset.id);
                    sidebar.classList.remove('open');
                    sidebarBackdrop.classList.remove('visible');
                });
            });
        }

        // ---- Open note ----
        function openNote(id) {
            const note = notes.find(n => n.id === id);
            if (!note) return;

            activeId = id;
            titleInput.value = note.title;
            editor.value = note.content;
            updatePreview();
            updateCounts();

            welcomeScreen.style.display = 'none';
            editorView.style.display = 'flex';
            renderList();
        }

        // ---- New note ----
        document.getElementById('newNoteBtn').addEventListener('click', () => {
            const note = {
                id: Date.now().toString(36) + Math.random().toString(36).slice(2, 6),
                title: '',
                content: '',
                created: Date.now(),
                updated: Date.now()
            };
            notes.unshift(note);
            saveNotes(notes);
            openNote(note.id);
            titleInput.focus();
            sidebar.classList.remove('open');
            sidebarBackdrop.classList.remove('visible');
        });

        // ---- Auto save ----
        function scheduleSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                const note = notes.find(n => n.id === activeId);
                if (!note) return;
                note.title = titleInput.value;
                note.content = editor.value;
                note.updated = Date.now();
                saveNotes(notes);
                renderList();
                flashSave();
            }, 400);
        }

        function flashSave() {
            saveIndicator.classList.add('visible');
            setTimeout(() => saveIndicator.classList.remove('visible'), 1500);
        }

        titleInput.addEventListener('input', scheduleSave);
        editor.addEventListener('input', () => {
            scheduleSave();
            updatePreview();
            updateCounts();
        });

        // ---- Tabs ----
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                panels.dataset.view = tab.dataset.view;
                updatePreview();
            });
        });

        // ---- Markdown parser (lightweight) ----
        function parseMarkdown(text) {
            let html = escapeHtml(text);

            // Code blocks
            html = html.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');

            // Inline code
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

            // Headers
            html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
            html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
            html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');

            // Bold & italic
            html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');

            // Blockquote
            html = html.replace(/^&gt; (.+)$/gm, '<blockquote>$1</blockquote>');

            // Horizontal rule
            html = html.replace(/^---$/gm, '<hr>');

            // Unordered list
            html = html.replace(/^[\-\*] (.+)$/gm, '<li>$1</li>');
            html = html.replace(/((<li>.*<\/li>\n?)+)/g, '<ul>$1</ul>');

            // Ordered list
            html = html.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');

            // Links
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');

            // Paragraphs
            html = html.replace(/\n\n/g, '</p><p>');
            html = html.replace(/\n/g, '<br>');

            // Clean up
            html = '<p>' + html + '</p>';
            html = html.replace(/<p><(h[1-3]|ul|ol|pre|blockquote|hr)/g, '<$1');
            html = html.replace(/<\/(h[1-3]|ul|ol|pre|blockquote)><\/p>/g, '</$1>');
            html = html.replace(/<hr><\/p>/g, '<hr>');
            html = html.replace(/<p><\/p>/g, '');

            return html;
        }

        function updatePreview() {
            preview.innerHTML = parseMarkdown(editor.value);
        }

        function updateCounts() {
            const text = editor.value;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            wordCountEl.textContent = words + ' slow';
            charCountEl.textContent = text.length + ' znakow';
        }

        // ---- Tab key in editor ----
        editor.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = editor.selectionStart;
                const end = editor.selectionEnd;
                editor.value = editor.value.substring(0, start) + '    ' + editor.value.substring(end);
                editor.selectionStart = editor.selectionEnd = start + 4;
                scheduleSave();
            }
        });

        // ---- Delete note (keyboard shortcut) ----
        document.addEventListener('keydown', (e) => {
            // Ctrl+Shift+D — delete note
            if (e.ctrlKey && e.shiftKey && e.key === 'D' && activeId) {
                e.preventDefault();
                if (confirm('Usunac te notatke?')) {
                    notes = notes.filter(n => n.id !== activeId);
                    saveNotes(notes);
                    activeId = null;
                    welcomeScreen.style.display = 'flex';
                    editorView.style.display = 'none';
                    renderList();
                }
            }
            // Ctrl+N — new note
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                document.getElementById('newNoteBtn').click();
            }
        });

        // ---- Helpers ----
        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function formatDate(ts) {
            const d = new Date(ts);
            const pad = n => String(n).padStart(2, '0');
            return `${pad(d.getDate())}.${pad(d.getMonth() + 1)}.${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
        }

        // ---- Init ----
        renderList();

        // If we have notes, open the most recent
        if (notes.length > 0) {
            const sorted = [...notes].sort((a, b) => b.updated - a.updated);
            openNote(sorted[0].id);
        }
    </script>
</body>
</html>
